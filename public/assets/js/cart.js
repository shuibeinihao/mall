define(["jquery","vue"],function(t,n){"use strict";function e(t){return t&&t.__esModule?t.default:t}function r(t,n){return n={exports:{}},t(n,n.exports),n.exports}function i(t){B||(B=G()),B.find(".js-msg").html(t),B.fadeIn(),setTimeout(function(){B.fadeOut()},2e3)}function o(n){n.keydown(function(n){-1!==t.inArray(n.keyCode,[46,8,9,27,13,110,190])||65===n.keyCode&&(!0===n.ctrlKey||!0===n.metaKey)||n.keyCode>=35&&n.keyCode<=40||(n.shiftKey||n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.preventDefault()})}function a(t){return new K(t)}function c(n,e){n=t.extend({msg:"",onebutton:!1},n),q?q.find(".js-dialog-cancel").off().on(L,function(t){z(t),q.hide()}).end().find(".js-dialog-ok").off().on(L,function(t){z(t),e&&"function"==typeof e&&e(),q.hide()}).end():q=t(W).find(".js-dialog-cancel").off().on(L,function(t){z(t),q.hide()}).end().find(".js-dialog-ok").off().on(L,function(t){z(t),e&&"function"==typeof e&&e(),q.hide()}).end().appendTo("body"),n.msg&&(q.hide(),q.find(".js-msg").html(n.msg),n.onebutton?q.find(".js-dialog-cancel").hide():q.find(".js-dialog-cancel").show(),q.show())}function u(t){H||(H=Q()),t?H.fadeIn():H.hide()}t="default"in t?t.default:t,n="default"in n?n.default:n;var s=r(function(t,n){n.__esModule=!0,n.default=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}}),f=e(s),l=r(function(t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)}),d=r(function(t){var n=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)}),h=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},p=function(t,n,e){if(h(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,i){return t.call(n,e,r,i)}}return function(){return t.apply(n,arguments)}},v=function(t){return"object"==typeof t?null!==t:"function"==typeof t},m=function(t){if(!v(t))throw TypeError(t+" is not an object!");return t},y=function(t){try{return!!t()}catch(t){return!0}},g=!y(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),_=l.document,j=v(_)&&v(_.createElement),w=function(t){return j?_.createElement(t):{}},b=!g&&!y(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),k=function(t,n){if(!v(t))return t;var e,r;if(n&&"function"==typeof(e=t.toString)&&!v(r=e.call(t)))return r;if("function"==typeof(e=t.valueOf)&&!v(r=e.call(t)))return r;if(!n&&"function"==typeof(e=t.toString)&&!v(r=e.call(t)))return r;throw TypeError("Can't convert object to primitive value")},C=Object.defineProperty,O=g?Object.defineProperty:function(t,n,e){if(m(t),n=k(n,!0),m(e),b)try{return C(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t},S={f:O},P=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}},x=g?function(t,n,e){return S.f(t,n,P(1,e))}:function(t,n,e){return t[n]=e,t},T=function(t,n,e){var r,i,o,a=t&T.F,c=t&T.G,u=t&T.S,s=t&T.P,f=t&T.B,h=t&T.W,v=c?d:d[n]||(d[n]={}),m=v.prototype,y=c?l:u?l[n]:(l[n]||{}).prototype;c&&(e=n);for(r in e)(i=!a&&y&&void 0!==y[r])&&r in v||(o=i?y[r]:e[r],v[r]=c&&"function"!=typeof y[r]?e[r]:f&&i?p(o,l):h&&y[r]==o?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n.prototype=t.prototype,n}(o):s&&"function"==typeof o?p(Function.call,o):o,s&&((v.virtual||(v.virtual={}))[r]=o,t&T.R&&m&&!m[r]&&x(m,r,o)))};T.F=1,T.G=2,T.S=4,T.P=8,T.B=16,T.W=32,T.U=64,T.R=128;var M=T;M(M.S+M.F*!g,"Object",{defineProperty:S.f});var I=d.Object,E=function(t,n,e){return I.defineProperty(t,n,e)},A=r(function(t){t.exports={default:E,__esModule:!0}}),N=r(function(t,n){n.__esModule=!0;var e=function(t){return t&&t.__esModule?t:{default:t}}(A);n.default=function(){function t(t,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,e.default)(t,i.key,i)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}()}),F=e(N),U="ontouchstart"in window,R=U?"touchstart":"click",D=window.location;t(function(){U&&t("a.js-a").on(R,function(t){t.preventDefault(),t.stopPropagation(),D.href=t.currentTarget.href})});var L=R,B=void 0,G=function(){return t('<div class="ui-dialog-wrapper ui-alert ui-row"><div class="ui-row-cell ui-row-cell-middle"><span class="loadingtip-msg js-msg"></span></div></div>').appendTo("body")},J=20,K=function(){function n(e){var r=this;f(this,n),this.amount=t(e);var a=t.Callbacks(),c=this.amount.find(".js-amount-input");o(c);var u=+this.amount.find(".js-amount-input").attr("data-limit"),s=+c.data("max");this.minNum=J,u?(this.minNum=Math.min(s,J,u),c.data("max",this.minNum)):(this.minNum=Math.min(s,J),c.data("max",this.minNum));var l=function(t){var n=t;t<1?(n=1,i("商品不能再减少了哦～")):t>r.minNum&&(n=r.minNum,i("商品不能购买更多了哦～")),c.val(n),a.fire(n)};c.on("change blur",function(t){t.preventDefault(),t.stopPropagation();var n=+c.val();l(n),r.updateInputUI()}),this.amount.find(".js-amount-dec").on(L,function(t){t.stopPropagation(),t.preventDefault();var n=+c.val();l(n-1),r.updateInputUI()}),this.amount.find(".js-amount-inc").on(L,function(t){t.stopPropagation(),t.preventDefault();var n=+c.val();l(n+1),r.updateInputUI()}),this.updateInputUI(),this._input=c,this._callbacks=a}return F(n,[{key:"updateInputUI",value:function(){var t=+this.amount.find(".js-amount-input").val();t<2?this.amount.find(".js-amount-dec").addClass("set-gray"):this.amount.find(".js-amount-dec").removeClass("set-gray"),t>=this.minNum?this.amount.find(".js-amount-inc").addClass("set-gray"):this.amount.find(".js-amount-inc").removeClass("set-gray")}},{key:"add",value:function(t){this._callbacks.add(t)}},{key:"setMax",value:function(t,n){t=n?Math.min(t,J,n):Math.min(t,J),this.minNum=t,this._input.val()>t&&(this._input.val(t),this._callbacks.fire(t)),this._input.data("max",t)}},{key:"val",get:function(){return this._input.val()}}]),n}(),W='<div class="ui-dialog-wrapper ui-alert ui-row"><div class="ui-row-cell ui-row-cell-middle"><div class="ui-dialog"><div class="ui-dialog-msg js-msg"></div><div class="ui-dialog-btns js-btns"><span class="ui-dialog-button ui-touchable js-dialog-cancel">取消</span><span class="ui-dialog-button ui-touchable js-dialog-ok">确定</span></div></div></div></div>',q=void 0,z=function(t){t.preventDefault(),t.stopPropagation()},H=void 0,Q=function(){return t('<div class="ui-dialog-wrapper ui-alert ui-row"><div class="ui-row-cell ui-row-cell-middle"><span class="loadingtip-msg js-msg" style="padding:1rem;border-radius: 5px;"><div class="spinner"><div class="spinner-container container1"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container2"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container3"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div></div></span></div></div>').appendTo("body")},V=d.JSON||(d.JSON={stringify:JSON.stringify}),X=function(t){return V.stringify.apply(V,arguments)},Y=r(function(t){t.exports={default:X,__esModule:!0}}),Z=e(Y),$=Math.ceil,tt=Math.floor,nt=function(t){return isNaN(t=+t)?0:(t>0?tt:$)(t)},et=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},rt=x,it={}.hasOwnProperty,ot=function(t,n){return it.call(t,n)},at={},ct={}.toString,ut=function(t){return ct.call(t).slice(8,-1)},st=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==ut(t)?t.split(""):Object(t)},ft=function(t){return st(et(t))},lt=Math.min,dt=function(t){return t>0?lt(nt(t),9007199254740991):0},ht=Math.max,pt=Math.min,vt=function(t,n){return t=nt(t),t<0?ht(t+n,0):pt(t,n)},mt=l["__core-js_shared__"]||(l["__core-js_shared__"]={}),yt=function(t){return mt[t]||(mt[t]={})},gt=0,_t=Math.random(),jt=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++gt+_t).toString(36))},wt=yt("keys"),bt=function(t){return wt[t]||(wt[t]=jt(t))},kt=function(t){return function(n,e,r){var i,o=ft(n),a=dt(o.length),c=vt(r,a);if(t&&e!=e){for(;a>c;)if((i=o[c++])!=i)return!0}else for(;a>c;c++)if((t||c in o)&&o[c]===e)return t||c||0;return!t&&-1}}(!1),Ct=bt("IE_PROTO"),Ot=function(t,n){var e,r=ft(t),i=0,o=[];for(e in r)e!=Ct&&ot(r,e)&&o.push(e);for(;n.length>i;)ot(r,e=n[i++])&&(~kt(o,e)||o.push(e));return o},St="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Pt=Object.keys||function(t){return Ot(t,St)},xt=g?Object.defineProperties:function(t,n){m(t);for(var e,r=Pt(n),i=r.length,o=0;i>o;)S.f(t,e=r[o++],n[e]);return t},Tt=l.document&&document.documentElement,Mt=bt("IE_PROTO"),It=function(){},Et=function(){var t,n=w("iframe"),e=St.length;for(n.style.display="none",Tt.appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),Et=t.F;e--;)delete Et.prototype[St[e]];return Et()},At=Object.create||function(t,n){var e;return null!==t?(It.prototype=m(t),e=new It,It.prototype=null,e[Mt]=t):e=Et(),void 0===n?e:xt(e,n)},Nt=r(function(t){var n=yt("wks"),e=l.Symbol,r="function"==typeof e;(t.exports=function(t){return n[t]||(n[t]=r&&e[t]||(r?e:jt)("Symbol."+t))}).store=n}),Ft=S.f,Ut=Nt("toStringTag"),Rt=function(t,n,e){t&&!ot(t=e?t:t.prototype,Ut)&&Ft(t,Ut,{configurable:!0,value:n})},Dt={};x(Dt,Nt("iterator"),function(){return this});var Lt=function(t,n,e){t.prototype=At(Dt,{next:P(1,e)}),Rt(t,n+" Iterator")},Bt=function(t){return Object(et(t))},Gt=bt("IE_PROTO"),Jt=Object.prototype,Kt=Object.getPrototypeOf||function(t){return t=Bt(t),ot(t,Gt)?t[Gt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Jt:null},Wt=Nt("iterator"),qt=!([].keys&&"next"in[].keys()),zt=function(){return this},Ht=function(t,n,e,r,i,o,a){Lt(e,n,r);var c,u,s,f=function(t){if(!qt&&t in p)return p[t];switch(t){case"keys":case"values":return function(){return new e(this,t)}}return function(){return new e(this,t)}},l=n+" Iterator",d="values"==i,h=!1,p=t.prototype,v=p[Wt]||p["@@iterator"]||i&&p[i],m=v||f(i),y=i?d?f("entries"):m:void 0,g="Array"==n?p.entries||v:v;if(g&&(s=Kt(g.call(new t)))!==Object.prototype&&Rt(s,l,!0),d&&v&&"values"!==v.name&&(h=!0,m=function(){return v.call(this)}),a&&(qt||h||!p[Wt])&&x(p,Wt,m),at[n]=m,at[l]=zt,i)if(c={values:d?m:f("values"),keys:o?m:f("keys"),entries:y},a)for(u in c)u in p||rt(p,u,c[u]);else M(M.P+M.F*(qt||h),n,c);return c},Qt=function(t){return function(n,e){var r,i,o=String(et(n)),a=nt(e),c=o.length;return a<0||a>=c?t?"":void 0:(r=o.charCodeAt(a),r<55296||r>56319||a+1===c||(i=o.charCodeAt(a+1))<56320||i>57343?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536)}}(!0);Ht(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=Qt(n,e),this._i+=t.length,{value:t,done:!1})});var Vt=function(t,n){return{value:n,done:!!t}};Ht(Array,"Array",function(t,n){this._t=ft(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,Vt(1)):"keys"==n?Vt(0,e):"values"==n?Vt(0,t[e]):Vt(0,[e,t[e]])},"values");at.Arguments=at.Array;for(var Xt=Nt("toStringTag"),Yt=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],Zt=0;Zt<5;Zt++){var $t=Yt[Zt],tn=l[$t],nn=tn&&tn.prototype;nn&&!nn[Xt]&&x(nn,Xt,$t),at[$t]=at.Array}var en,rn,on,an=Nt("toStringTag"),cn="Arguments"==ut(function(){return arguments}()),un=function(t,n){try{return t[n]}catch(t){}},sn=function(t){var n,e,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=un(n=Object(t),an))?e:cn?ut(n):"Object"==(r=ut(n))&&"function"==typeof n.callee?"Arguments":r},fn=function(t,n,e,r){if(!(t instanceof n)||void 0!==r&&r in t)throw TypeError(e+": incorrect invocation!");return t},ln=function(t,n,e,r){try{return r?n(m(e)[0],e[1]):n(e)}catch(n){var i=t.return;throw void 0!==i&&m(i.call(t)),n}},dn=Nt("iterator"),hn=Array.prototype,pn=function(t){return void 0!==t&&(at.Array===t||hn[dn]===t)},vn=Nt("iterator"),mn=d.getIteratorMethod=function(t){if(void 0!=t)return t[vn]||t["@@iterator"]||at[sn(t)]},yn=r(function(t){var n={},e={},r=t.exports=function(t,r,i,o,a){var c,u,s,f,l=a?function(){return t}:mn(t),d=p(i,o,r?2:1),h=0;if("function"!=typeof l)throw TypeError(t+" is not iterable!");if(pn(l)){for(c=dt(t.length);c>h;h++)if((f=r?d(m(u=t[h])[0],u[1]):d(t[h]))===n||f===e)return f}else for(s=l.call(t);!(u=s.next()).done;)if((f=ln(s,d,u.value,r))===n||f===e)return f};r.BREAK=n,r.RETURN=e}),gn=Nt("species"),_n=function(t,n){var e,r=m(t).constructor;return void 0===r||void 0==(e=m(r)[gn])?n:h(e)},jn=function(t,n,e){var r=void 0===e;switch(n.length){case 0:return r?t():t.call(e);case 1:return r?t(n[0]):t.call(e,n[0]);case 2:return r?t(n[0],n[1]):t.call(e,n[0],n[1]);case 3:return r?t(n[0],n[1],n[2]):t.call(e,n[0],n[1],n[2]);case 4:return r?t(n[0],n[1],n[2],n[3]):t.call(e,n[0],n[1],n[2],n[3])}return t.apply(e,n)},wn=l.process,bn=l.setImmediate,kn=l.clearImmediate,Cn=l.MessageChannel,On=0,Sn={},Pn=function(){var t=+this;if(Sn.hasOwnProperty(t)){var n=Sn[t];delete Sn[t],n()}},xn=function(t){Pn.call(t.data)};bn&&kn||(bn=function(t){for(var n=[],e=1;arguments.length>e;)n.push(arguments[e++]);return Sn[++On]=function(){jn("function"==typeof t?t:Function(t),n)},en(On),On},kn=function(t){delete Sn[t]},"process"==ut(wn)?en=function(t){wn.nextTick(p(Pn,t,1))}:Cn?(rn=new Cn,on=rn.port2,rn.port1.onmessage=xn,en=p(on.postMessage,on,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(en=function(t){l.postMessage(t+"","*")},l.addEventListener("message",xn,!1)):en="onreadystatechange"in w("script")?function(t){Tt.appendChild(w("script")).onreadystatechange=function(){Tt.removeChild(this),Pn.call(t)}}:function(t){setTimeout(p(Pn,t,1),0)});var Tn={set:bn,clear:kn},Mn=Tn.set,In=l.MutationObserver||l.WebKitMutationObserver,En=l.process,An=l.Promise,Nn="process"==ut(En),Fn=Nt("species"),Un=Nt("iterator"),Rn=!1;try{var Dn=[7][Un]();Dn.return=function(){Rn=!0},Array.from(Dn,function(){throw 2})}catch(t){}var Ln,Bn,Gn,Jn=Tn.set,Kn=function(){var t,n,e,r=function(){var r,i;for(Nn&&(r=En.domain)&&r.exit();t;){i=t.fn,t=t.next;try{i()}catch(r){throw t?e():n=void 0,r}}n=void 0,r&&r.enter()};if(Nn)e=function(){En.nextTick(r)};else if(In){var i=!0,o=document.createTextNode("");new In(r).observe(o,{characterData:!0}),e=function(){o.data=i=!i}}else if(An&&An.resolve){var a=An.resolve();e=function(){a.then(r)}}else e=function(){Mn.call(l,r)};return function(r){var i={fn:r,next:void 0};n&&(n.next=i),t||(t=i,e()),n=i}}(),Wn=l.TypeError,qn=l.process,zn=l.Promise,qn=l.process,Hn="process"==sn(qn),Qn=function(){},Vn=!!function(){try{var t=zn.resolve(1),n=(t.constructor={})[Nt("species")]=function(t){t(Qn,Qn)};return(Hn||"function"==typeof PromiseRejectionEvent)&&t.then(Qn)instanceof n}catch(t){}}(),Xn=function(t,n){return t===n||t===zn&&n===Gn},Yn=function(t){var n;return!(!v(t)||"function"!=typeof(n=t.then))&&n},Zn=function(t){return Xn(zn,t)?new $n(t):new Bn(t)},$n=Bn=function(t){var n,e;this.promise=new t(function(t,r){if(void 0!==n||void 0!==e)throw Wn("Bad Promise constructor");n=t,e=r}),this.resolve=h(n),this.reject=h(e)},te=function(t){try{t()}catch(t){return{error:t}}},ne=function(t,n){if(!t._n){t._n=!0;var e=t._c;Kn(function(){for(var r=t._v,i=1==t._s,o=0;e.length>o;)!function(n){var e,o,a=i?n.ok:n.fail,c=n.resolve,u=n.reject,s=n.domain;try{a?(i||(2==t._h&&ie(t),t._h=1),!0===a?e=r:(s&&s.enter(),e=a(r),s&&s.exit()),e===n.promise?u(Wn("Promise-chain cycle")):(o=Yn(e))?o.call(e,c,u):c(e)):u(r)}catch(t){u(t)}}(e[o++]);t._c=[],t._n=!1,n&&!t._h&&ee(t)})}},ee=function(t){Jn.call(l,function(){var n,e,r,i=t._v;if(re(t)&&(n=te(function(){Hn?qn.emit("unhandledRejection",i,t):(e=l.onunhandledrejection)?e({promise:t,reason:i}):(r=l.console)&&r.error&&r.error("Unhandled promise rejection",i)}),t._h=Hn||re(t)?2:1),t._a=void 0,n)throw n.error})},re=function(t){if(1==t._h)return!1;for(var n,e=t._a||t._c,r=0;e.length>r;)if(n=e[r++],n.fail||!re(n.promise))return!1;return!0},ie=function(t){Jn.call(l,function(){var n;Hn?qn.emit("rejectionHandled",t):(n=l.onrejectionhandled)&&n({promise:t,reason:t._v})})},oe=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),ne(n,!0))},ae=function(t){var n,e=this;if(!e._d){e._d=!0,e=e._w||e;try{if(e===t)throw Wn("Promise can't be resolved itself");(n=Yn(t))?Kn(function(){var r={_w:e,_d:!1};try{n.call(t,p(ae,r,1),p(oe,r,1))}catch(t){oe.call(r,t)}}):(e._v=t,e._s=1,ne(e,!1))}catch(t){oe.call({_w:e,_d:!1},t)}}};Vn||(zn=function(t){fn(this,zn,"Promise","_h"),h(t),Ln.call(this);try{t(p(ae,this,1),p(oe,this,1))}catch(t){oe.call(this,t)}},Ln=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},Ln.prototype=function(t,n,e){for(var r in n)e&&t[r]?t[r]=n[r]:x(t,r,n[r]);return t}(zn.prototype,{then:function(t,n){var e=Zn(_n(this,zn));return e.ok="function"!=typeof t||t,e.fail="function"==typeof n&&n,e.domain=Hn?qn.domain:void 0,this._c.push(e),this._a&&this._a.push(e),this._s&&ne(this,!1),e.promise},catch:function(t){return this.then(void 0,t)}}),$n=function(){var t=new Ln;this.promise=t,this.resolve=p(ae,t,1),this.reject=p(oe,t,1)}),M(M.G+M.W+M.F*!Vn,{Promise:zn}),Rt(zn,"Promise"),function(t){var n="function"==typeof d[t]?d[t]:l[t];g&&n&&!n[Fn]&&S.f(n,Fn,{configurable:!0,get:function(){return this}})}("Promise"),Gn=d.Promise,M(M.S+M.F*!Vn,"Promise",{reject:function(t){var n=Zn(this);return(0,n.reject)(t),n.promise}}),M(M.S+!0*M.F,"Promise",{resolve:function(t){if(t instanceof zn&&Xn(t.constructor,this))return t;var n=Zn(this);return(0,n.resolve)(t),n.promise}}),M(M.S+M.F*!(Vn&&function(t,n){if(!n&&!Rn)return!1;var e=!1;try{var r=[7],i=r[Un]();i.next=function(){return{done:e=!0}},r[Un]=function(){return i},t(r)}catch(t){}return e}(function(t){zn.all(t).catch(Qn)})),"Promise",{all:function(t){var n=this,e=Zn(n),r=e.resolve,i=e.reject,o=te(function(){var e=[],o=0,a=1;yn(t,!1,function(t){var c=o++,u=!1;e.push(void 0),a++,n.resolve(t).then(function(t){u||(u=!0,e[c]=t,--a||r(e))},i)}),--a||r(e)});return o&&i(o.error),e.promise},race:function(t){var n=this,e=Zn(n),r=e.reject,i=te(function(){yn(t,!1,function(t){n.resolve(t).then(e.resolve,r)})});return i&&r(i.error),e.promise}});var ce=d.Promise,ue=r(function(t){t.exports={default:ce,__esModule:!0}}),se=e(ue),fe=function(n,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments[4];return new se(function(a,c){t.ajax({method:r,url:n,headers:o,async:i,contentType:"application/json",dataType:"json",data:Z(e),success:a,error:function(t){try{c(JSON.parse(t.responseText))}catch(n){c({error:!0,message:"解析JSON出错: "+t.responseText})}}})})};new n({el:"#cart",data:{isSwipe:[],isEdit:!1,isEditText:"编辑",currIntegral:"",isIntegral:!1,isCartEdit:!1},created:function(){var t=this;this.cartNumShow(),fe("/api/userscore/get-user-score",{},"GET").then(function(n){n.scoreEarned&&(t.currIntegral=n.scoreEarned,t.isIntegral=!0)}).catch(function(){i("网络错误，请稍后重试！")})},methods:{cartNumShow:function(){t(".data-cartNum").each(function(n,e){t(".cartNumInfo"+n).html(t(e).val())})},cart_edit:function(){!0===this.isEdit?(t(".js-cart-info").fadeIn(),t(".cart-delect-wrap").hide(),this.isEditText="编辑",this.cartNumShow(),this.isEdit=!1):(t(".js-cart-info").hide(),t(".cart-delect-wrap").fadeIn(),this.isEditText="完成",this.isEdit=!0)},clearFailureProd:function(n){le(n);for(var e=t(".cartFailureIds").attr("data-cartFailureIds"),r=e.split(","),o=[],a=0;a<r.length;a++)o.push(parseInt(r[a]));c({msg:"是否要清空失效商品？"},function(){u(!0),fe("/api/trade/cart/items",o,"POST").then(function(t){u(!1),t.success&&(i("失效商品删除成功！"),setTimeout(function(){location.reload()},1e3))}).catch(function(){u(!1),i("网络错误，请稍后重试！")})})}}});var le=function(t){t.preventDefault(),t.stopPropagation()},de=window.location.search.substr(1),he=t(".js-check"),pe=!1,ve=t(".js-check-all"),me=t(".js-delbtn"),ye=t(".js-total"),ge=t(".js-score"),_e=t(".js-to-purchase"),je=function(){return 0===he.filter(":not(.checked)").length},we=function(){return he.filter(".checked").length>0},be=0,ke={hasChecked:!1,isAllChecked:!1,hasAmountUpdate:!1},Ce=function(){var n=0,e=0,r=[];he.filter(".checked").each(function(){var i=t(this),o=i.data("id"),a=i.data("specid"),c=t("#amount_"+o),u=c.data("amountObj").val;r.push(a+"_"+u),n+=parseInt(u)*parseFloat(c.data("price")),e+=parseInt(u)*parseFloat(c.data("score"))}),ye.text(Number(n).toFixed(2)),ge.text(Number(e)),_e.on(L,function(t){if(le(t),!ke.hasChecked)return i("未选择商品"),!1;mixpanel.track("MobileMall: Cart: SubmitBtn: Click"),xksTrack.track("MobileMall:Shopping_Cart:SubmitBtn:Click"),location.href="/gp/order?p="+r.join("|")+"&&buyRoute=1&&"+de}),0==be&&(ke.hasAmountUpdate?Pe():(be=1,Se()))};t(Ce);var Oe=function(){ke.hasAmountUpdate=!0,be=0,Ce()};t(".js-amount").each(function(){var n=a(this);n.add(Oe),t(this).data("amountObj",n)});var Se=function(){var t=ke.isAllChecked;ve.toggleClass("checked",t),me.prop("disabled",!ke.hasChecked),Ce()},Pe=function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],o=e?he.filter(".checked"):he;o.each(function(){var n=t(this),i=n.data("id"),o=t("#amount_"+i),a=+o.data("amountObj").val;r.push({deleted:e,shoppingCart:{id:i,num:+a}})}),fe("/api/trade/update-shopping-cart",r,"PUT").then(function(t){if(t.success){if(!t.data.filter(function(t){return!!t.productSpecification}).length)return void location.reload(!0);e?(ke.hasChecked=!1,ke.isAllChecked=!1,o.closest(".js-prod").remove()):ke.hasAmountUpdate=!1}else c({msg:t.retMsg,onebutton:!0})}).catch(function(){i("网络错误，请稍后重试！")})};ve.on(L,function(t){le(t);var n=!ke.isAllChecked;ke.isAllChecked=n,ke.hasChecked=n,he.toggleClass("checked",n),Se()}),he.on(L,function(n){le(n);var e=t(n.currentTarget),r=!e.hasClass("checked");e.toggleClass("checked",r),r?(ke.hasChecked=!0,ke.isAllChecked=je()):(ke.isAllChecked=!1,ke.hasChecked=we()),Se()}),me.on(L,function(n){function e(){var e=t(n.target).attr("data-id");pe=!0;var r=[],o=t("#amount_"+e),a=o.data("amountObj").val;r.push({deleted:pe,shoppingCart:{id:e,num:+a}}),u(!0),fe("/api/trade/update-shopping-cart",r,"PUT").then(function(e){if(u(!1),e.success){if(i("删除成功！"),!e.data.filter(function(t){return!!t.productSpecification}).length)return void location.reload(!0);pe?(ke.hasChecked=!1,ke.isAllChecked=!1,t(n.target).closest(".js-prod").remove(),he=t(".js-check"),location.reload(!0)):ke.hasAmountUpdate=!1}}).catch(function(){u(!1),i("网络错误，请稍后重试！")})}var r=t(n.target).attr("data-productId");xksTrack.track("MobileMall:Shopping_Cart:Delete:Click",{productId:r}),c({msg:"您确定要删除此商品吗？"},e)})});
