define(["jquery","vue"],function(t,e){"use strict";function n(e,n){a?location.href="/api/trade/go-wechat-auth/"+e:n?t("body").append(n):t.get("/api/trade/get-alipay-url/"+e,function(e){t("body").append(e.data)})}function r(e,n){e=t.extend({msg:"",onebutton:!1},e),h?h.find(".js-dialog-cancel").off().on(l,function(t){v(t),h.hide()}).end().find(".js-dialog-ok").off().on(l,function(t){v(t),n&&"function"==typeof n&&n(),h.hide()}).end():h=t(p).find(".js-dialog-cancel").off().on(l,function(t){v(t),h.hide()}).end().find(".js-dialog-ok").off().on(l,function(t){v(t),n&&"function"==typeof n&&n(),h.hide()}).end().appendTo("body"),e.msg&&(h.hide(),h.find(".js-msg").html(e.msg),e.onebutton?h.find(".js-dialog-cancel").hide():h.find(".js-dialog-cancel").show(),h.show())}function o(t){y||(y=g()),y.find(".js-msg").html(t),y.fadeIn(),setTimeout(function(){y.fadeOut()},2e3)}function i(t){m||(m=_()),t?m.fadeIn():m.hide()}function c(t){return t&&t.__esModule?t.default:t}function s(t,e){return e={exports:{}},t(e,e.exports),e.exports}t="default"in t?t.default:t,e="default"in e?e.default:e;var a=/MicroMessenger/i.test(navigator.userAgent),u="ontouchstart"in window,d=u?"touchstart":"click",f=window.location;t(function(){u&&t("a.js-a").on(d,function(t){t.preventDefault(),t.stopPropagation(),f.href=t.currentTarget.href})});var l=d,p='<div class="ui-dialog-wrapper ui-alert ui-row"><div class="ui-row-cell ui-row-cell-middle"><div class="ui-dialog"><div class="ui-dialog-msg js-msg"></div><div class="ui-dialog-btns js-btns"><span class="ui-dialog-button ui-touchable js-dialog-cancel">取消</span><span class="ui-dialog-button ui-touchable js-dialog-ok">确定</span></div></div></div></div>',h=void 0,v=function(t){t.preventDefault(),t.stopPropagation()},y=void 0,g=function(){return t('<div class="ui-dialog-wrapper ui-alert ui-row"><div class="ui-row-cell ui-row-cell-middle"><span class="loadingtip-msg js-msg"></span></div></div>').appendTo("body")},m=void 0,_=function(){return t('<div class="ui-dialog-wrapper ui-alert ui-row"><div class="ui-row-cell ui-row-cell-middle"><span class="loadingtip-msg js-msg" style="padding:1rem;border-radius: 5px;"><div class="spinner"><div class="spinner-container container1"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container2"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container3"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div></div></span></div></div>').appendTo("body")},b=s(function(t){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)}),w=b.JSON||(b.JSON={stringify:JSON.stringify}),S=function(t){return w.stringify.apply(w,arguments)},j=s(function(t){t.exports={default:S,__esModule:!0}}),I=c(j),O=Math.ceil,P=Math.floor,M=function(t){return isNaN(t=+t)?0:(t>0?P:O)(t)},T=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},x=s(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),N=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},k=function(t,e,n){if(N(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},E=function(t){return"object"==typeof t?null!==t:"function"==typeof t},R=function(t){if(!E(t))throw TypeError(t+" is not an object!");return t},A=function(t){try{return!!t()}catch(t){return!0}},C=!A(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),F=x.document,L=E(F)&&E(F.createElement),G=function(t){return L?F.createElement(t):{}},B=!C&&!A(function(){return 7!=Object.defineProperty(G("div"),"a",{get:function(){return 7}}).a}),U=function(t,e){if(!E(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!E(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!E(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!E(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},J=Object.defineProperty,W=C?Object.defineProperty:function(t,e,n){if(R(t),e=U(e,!0),R(n),B)try{return J(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t},D={f:W},K=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},V=C?function(t,e,n){return D.f(t,e,K(1,n))}:function(t,e,n){return t[e]=n,t},q=function(t,e,n){var r,o,i,c=t&q.F,s=t&q.G,a=t&q.S,u=t&q.P,d=t&q.B,f=t&q.W,l=s?b:b[e]||(b[e]={}),p=l.prototype,h=s?x:a?x[e]:(x[e]||{}).prototype;s&&(n=e);for(r in n)(o=!c&&h&&void 0!==h[r])&&r in l||(i=o?h[r]:n[r],l[r]=s&&"function"!=typeof h[r]?n[r]:d&&o?k(i,x):f&&h[r]==i?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):u&&"function"==typeof i?k(Function.call,i):i,u&&((l.virtual||(l.virtual={}))[r]=i,t&q.R&&p&&!p[r]&&V(p,r,i)))};q.F=1,q.G=2,q.S=4,q.P=8,q.B=16,q.W=32,q.U=64,q.R=128;var z=q,H=V,Q={}.hasOwnProperty,X=function(t,e){return Q.call(t,e)},Y={},Z={}.toString,$=function(t){return Z.call(t).slice(8,-1)},tt=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==$(t)?t.split(""):Object(t)},et=function(t){return tt(T(t))},nt=Math.min,rt=function(t){return t>0?nt(M(t),9007199254740991):0},ot=Math.max,it=Math.min,ct=function(t,e){return t=M(t),t<0?ot(t+e,0):it(t,e)},st=x["__core-js_shared__"]||(x["__core-js_shared__"]={}),at=function(t){return st[t]||(st[t]={})},ut=0,dt=Math.random(),ft=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++ut+dt).toString(36))},lt=at("keys"),pt=function(t){return lt[t]||(lt[t]=ft(t))},ht=function(t){return function(e,n,r){var o,i=et(e),c=rt(i.length),s=ct(r,c);if(t&&n!=n){for(;c>s;)if((o=i[s++])!=o)return!0}else for(;c>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}}(!1),vt=pt("IE_PROTO"),yt=function(t,e){var n,r=et(t),o=0,i=[];for(n in r)n!=vt&&X(r,n)&&i.push(n);for(;e.length>o;)X(r,n=e[o++])&&(~ht(i,n)||i.push(n));return i},gt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),mt=Object.keys||function(t){return yt(t,gt)},_t=C?Object.defineProperties:function(t,e){R(t);for(var n,r=mt(e),o=r.length,i=0;o>i;)D.f(t,n=r[i++],e[n]);return t},bt=x.document&&document.documentElement,wt=pt("IE_PROTO"),St=function(){},jt=function(){var t,e=G("iframe"),n=gt.length;for(e.style.display="none",bt.appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),jt=t.F;n--;)delete jt.prototype[gt[n]];return jt()},It=Object.create||function(t,e){var n;return null!==t?(St.prototype=R(t),n=new St,St.prototype=null,n[wt]=t):n=jt(),void 0===e?n:_t(n,e)},Ot=s(function(t){var e=at("wks"),n=x.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:ft)("Symbol."+t))}).store=e}),Pt=D.f,Mt=Ot("toStringTag"),Tt=function(t,e,n){t&&!X(t=n?t:t.prototype,Mt)&&Pt(t,Mt,{configurable:!0,value:e})},xt={};V(xt,Ot("iterator"),function(){return this});var Nt=function(t,e,n){t.prototype=It(xt,{next:K(1,n)}),Tt(t,e+" Iterator")},kt=function(t){return Object(T(t))},Et=pt("IE_PROTO"),Rt=Object.prototype,At=Object.getPrototypeOf||function(t){return t=kt(t),X(t,Et)?t[Et]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Rt:null},Ct=Ot("iterator"),Ft=!([].keys&&"next"in[].keys()),Lt=function(){return this},Gt=function(t,e,n,r,o,i,c){Nt(n,e,r);var s,a,u,d=function(t){if(!Ft&&t in h)return h[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},f=e+" Iterator",l="values"==o,p=!1,h=t.prototype,v=h[Ct]||h["@@iterator"]||o&&h[o],y=v||d(o),g=o?l?d("entries"):y:void 0,m="Array"==e?h.entries||v:v;if(m&&(u=At(m.call(new t)))!==Object.prototype&&Tt(u,f,!0),l&&v&&"values"!==v.name&&(p=!0,y=function(){return v.call(this)}),c&&(Ft||p||!h[Ct])&&V(h,Ct,y),Y[e]=y,Y[f]=Lt,o)if(s={values:l?y:d("values"),keys:i?y:d("keys"),entries:g},c)for(a in s)a in h||H(h,a,s[a]);else z(z.P+z.F*(Ft||p),e,s);return s},Bt=function(t){return function(e,n){var r,o,i=String(T(e)),c=M(n),s=i.length;return c<0||c>=s?t?"":void 0:(r=i.charCodeAt(c),r<55296||r>56319||c+1===s||(o=i.charCodeAt(c+1))<56320||o>57343?t?i.charAt(c):r:t?i.slice(c,c+2):o-56320+(r-55296<<10)+65536)}}(!0);Gt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=Bt(e,n),this._i+=t.length,{value:t,done:!1})});var Ut=function(t,e){return{value:e,done:!!t}};Gt(Array,"Array",function(t,e){this._t=et(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,Ut(1)):"keys"==e?Ut(0,n):"values"==e?Ut(0,t[n]):Ut(0,[n,t[n]])},"values");Y.Arguments=Y.Array;for(var Jt=Ot("toStringTag"),Wt=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],Dt=0;Dt<5;Dt++){var Kt=Wt[Dt],Vt=x[Kt],qt=Vt&&Vt.prototype;qt&&!qt[Jt]&&V(qt,Jt,Kt),Y[Kt]=Y.Array}var zt,Ht,Qt,Xt=Ot("toStringTag"),Yt="Arguments"==$(function(){return arguments}()),Zt=function(t,e){try{return t[e]}catch(t){}},$t=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=Zt(e=Object(t),Xt))?n:Yt?$(e):"Object"==(r=$(e))&&"function"==typeof e.callee?"Arguments":r},te=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},ee=function(t,e,n,r){try{return r?e(R(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&R(o.call(t)),e}},ne=Ot("iterator"),re=Array.prototype,oe=function(t){return void 0!==t&&(Y.Array===t||re[ne]===t)},ie=Ot("iterator"),ce=b.getIteratorMethod=function(t){if(void 0!=t)return t[ie]||t["@@iterator"]||Y[$t(t)]},se=s(function(t){var e={},n={},r=t.exports=function(t,r,o,i,c){var s,a,u,d,f=c?function(){return t}:ce(t),l=k(o,i,r?2:1),p=0;if("function"!=typeof f)throw TypeError(t+" is not iterable!");if(oe(f)){for(s=rt(t.length);s>p;p++)if((d=r?l(R(a=t[p])[0],a[1]):l(t[p]))===e||d===n)return d}else for(u=f.call(t);!(a=u.next()).done;)if((d=ee(u,l,a.value,r))===e||d===n)return d};r.BREAK=e,r.RETURN=n}),ae=Ot("species"),ue=function(t,e){var n,r=R(t).constructor;return void 0===r||void 0==(n=R(r)[ae])?e:N(n)},de=function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)},fe=x.process,le=x.setImmediate,pe=x.clearImmediate,he=x.MessageChannel,ve=0,ye={},ge=function(){var t=+this;if(ye.hasOwnProperty(t)){var e=ye[t];delete ye[t],e()}},me=function(t){ge.call(t.data)};le&&pe||(le=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return ye[++ve]=function(){de("function"==typeof t?t:Function(t),e)},zt(ve),ve},pe=function(t){delete ye[t]},"process"==$(fe)?zt=function(t){fe.nextTick(k(ge,t,1))}:he?(Ht=new he,Qt=Ht.port2,Ht.port1.onmessage=me,zt=k(Qt.postMessage,Qt,1)):x.addEventListener&&"function"==typeof postMessage&&!x.importScripts?(zt=function(t){x.postMessage(t+"","*")},x.addEventListener("message",me,!1)):zt="onreadystatechange"in G("script")?function(t){bt.appendChild(G("script")).onreadystatechange=function(){bt.removeChild(this),ge.call(t)}}:function(t){setTimeout(k(ge,t,1),0)});var _e={set:le,clear:pe},be=_e.set,we=x.MutationObserver||x.WebKitMutationObserver,Se=x.process,je=x.Promise,Ie="process"==$(Se),Oe=Ot("species"),Pe=Ot("iterator"),Me=!1;try{var Te=[7][Pe]();Te.return=function(){Me=!0},Array.from(Te,function(){throw 2})}catch(t){}var xe,Ne,ke,Ee=_e.set,Re=function(){var t,e,n,r=function(){var r,o;for(Ie&&(r=Se.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(Ie)n=function(){Se.nextTick(r)};else if(we){var o=!0,i=document.createTextNode("");new we(r).observe(i,{characterData:!0}),n=function(){i.data=o=!o}}else if(je&&je.resolve){var c=je.resolve();n=function(){c.then(r)}}else n=function(){be.call(x,r)};return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}(),Ae=x.TypeError,Ce=x.process,Fe=x.Promise,Ce=x.process,Le="process"==$t(Ce),Ge=function(){},Be=!!function(){try{var t=Fe.resolve(1),e=(t.constructor={})[Ot("species")]=function(t){t(Ge,Ge)};return(Le||"function"==typeof PromiseRejectionEvent)&&t.then(Ge)instanceof e}catch(t){}}(),Ue=function(t,e){return t===e||t===Fe&&e===ke},Je=function(t){var e;return!(!E(t)||"function"!=typeof(e=t.then))&&e},We=function(t){return Ue(Fe,t)?new De(t):new Ne(t)},De=Ne=function(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw Ae("Bad Promise constructor");e=t,n=r}),this.resolve=N(e),this.reject=N(n)},Ke=function(t){try{t()}catch(t){return{error:t}}},Ve=function(t,e){if(!t._n){t._n=!0;var n=t._c;Re(function(){for(var r=t._v,o=1==t._s,i=0;n.length>i;)!function(e){var n,i,c=o?e.ok:e.fail,s=e.resolve,a=e.reject,u=e.domain;try{c?(o||(2==t._h&&He(t),t._h=1),!0===c?n=r:(u&&u.enter(),n=c(r),u&&u.exit()),n===e.promise?a(Ae("Promise-chain cycle")):(i=Je(n))?i.call(n,s,a):s(n)):a(r)}catch(t){a(t)}}(n[i++]);t._c=[],t._n=!1,e&&!t._h&&qe(t)})}},qe=function(t){Ee.call(x,function(){var e,n,r,o=t._v;if(ze(t)&&(e=Ke(function(){Le?Ce.emit("unhandledRejection",o,t):(n=x.onunhandledrejection)?n({promise:t,reason:o}):(r=x.console)&&r.error&&r.error("Unhandled promise rejection",o)}),t._h=Le||ze(t)?2:1),t._a=void 0,e)throw e.error})},ze=function(t){if(1==t._h)return!1;for(var e,n=t._a||t._c,r=0;n.length>r;)if(e=n[r++],e.fail||!ze(e.promise))return!1;return!0},He=function(t){Ee.call(x,function(){var e;Le?Ce.emit("rejectionHandled",t):(e=x.onrejectionhandled)&&e({promise:t,reason:t._v})})},Qe=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),Ve(e,!0))},Xe=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw Ae("Promise can't be resolved itself");(e=Je(t))?Re(function(){var r={_w:n,_d:!1};try{e.call(t,k(Xe,r,1),k(Qe,r,1))}catch(t){Qe.call(r,t)}}):(n._v=t,n._s=1,Ve(n,!1))}catch(t){Qe.call({_w:n,_d:!1},t)}}};Be||(Fe=function(t){te(this,Fe,"Promise","_h"),N(t),xe.call(this);try{t(k(Xe,this,1),k(Qe,this,1))}catch(t){Qe.call(this,t)}},xe=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},xe.prototype=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:V(t,r,e[r]);return t}(Fe.prototype,{then:function(t,e){var n=We(ue(this,Fe));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=Le?Ce.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Ve(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),De=function(){var t=new xe;this.promise=t,this.resolve=k(Xe,t,1),this.reject=k(Qe,t,1)}),z(z.G+z.W+z.F*!Be,{Promise:Fe}),Tt(Fe,"Promise"),function(t){var e="function"==typeof b[t]?b[t]:x[t];C&&e&&!e[Oe]&&D.f(e,Oe,{configurable:!0,get:function(){return this}})}("Promise"),ke=b.Promise,z(z.S+z.F*!Be,"Promise",{reject:function(t){var e=We(this);return(0,e.reject)(t),e.promise}}),z(z.S+!0*z.F,"Promise",{resolve:function(t){if(t instanceof Fe&&Ue(t.constructor,this))return t;var e=We(this);return(0,e.resolve)(t),e.promise}}),z(z.S+z.F*!(Be&&function(t,e){if(!e&&!Me)return!1;var n=!1;try{var r=[7],o=r[Pe]();o.next=function(){return{done:n=!0}},r[Pe]=function(){return o},t(r)}catch(t){}return n}(function(t){Fe.all(t).catch(Ge)})),"Promise",{all:function(t){var e=this,n=We(e),r=n.resolve,o=n.reject,i=Ke(function(){var n=[],i=0,c=1;se(t,!1,function(t){var s=i++,a=!1;n.push(void 0),c++,e.resolve(t).then(function(t){a||(a=!0,n[s]=t,--c||r(n))},o)}),--c||r(n)});return i&&o(i.error),n.promise},race:function(t){var e=this,n=We(e),r=n.reject,o=Ke(function(){se(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o&&r(o.error),n.promise}});var Ye=b.Promise,Ze=s(function(t){t.exports={default:Ye,__esModule:!0}}),$e=c(Ze),tn=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments[4];return new $e(function(c,s){t.ajax({method:r,url:e,headers:i,async:o,contentType:"application/json",dataType:"json",data:I(n),success:c,error:function(t){try{s(JSON.parse(t.responseText))}catch(e){s({error:!0,message:"解析JSON出错: "+t.responseText})}}})})};new e({el:"#order",data:{count:0,orderAddress:{},isAddress:!0,msg:"",selected:"不开发票",companyName:"",addressId:"",productId:[],type:0,postage:"0",currIntegral:"0",isIntegral:!1,userNeedScore:"0",userNeedPrice:"0",couponMoney:"0.00",couponId:"",couponSign:"",totalMoney:"0",couponList:{},couponName:"无可用优惠券",productSpecification:"",writeReceipt:0,couponInfo:"",taxpayerNum:"",buyRoute:"",isSubmit:!1},created:function(){function e(t){tn("/api/trade/mall/calc-postage?addressId="+t,l,"POST").then(function(t){n.isSubmit=!0,t.success?(n.postage=t.data,n.userNeedPrice||(n.userNeedPrice=0),parseFloat(n.userNeedPrice)>=parseFloat(n.couponMoney)?n.totalMoney=(n.userNeedPrice-n.couponMoney+n.postage).toFixed(2):(r({msg:"优惠券不能抵扣运费,只能抵扣商品金额整数部分哦！",onebutton:!0}),n.totalMoney=(parseFloat("0."+parseFloat(n.userNeedPrice).toFixed(2).split(".")[1])+n.postage).toFixed(2))):o(t.retMsg)}).catch(function(){o("网络错误，请稍后重试！")})}var n=this;n.writeReceipt=t(".order-product").attr("data-writeReceipt"),n.userNeedScore=t(".order-score").attr("data-score"),n.userNeedPrice=t(".order-price").attr("data-price");for(var i="",c="",s=window.location.search.substr(1).split("&&"),a=0;a<s.length;a++)"couponId"===s[a].split("=")[0]?this.couponInfo=s[a]:"p"===s[a].split("=")[0]?this.productSpecification=s[a].split("=")[1]:"addressId"===s[a].split("=")[0]?c=s[a].split("=")[1]:"buyRoute"===s[a].split("=")[0]&&(this.buyRoute=s[a].split("=")[1]);if(this.couponInfo)for(var u=this.couponInfo.split("&"),d=0;d<u.length;d++)"couponId"===u[d].split("=")[0]&&(i=u[d].split("=")[1]);var f="",l={};if(this.productSpecification){f=this.productSpecification.split("|"),f.forEach(function(t){for(var e=0;e<t.split("_")[1];e++)n.productId.push(t.split("_")[0])});for(var p=0;p<f.length;p++){var h=f[p].split("_")[0],v=f[p].split("_")[1];l[h]=v}}if(tn("/api/trade/coupon",n.productId,"POST",!1).then(function(t){if(t.length){n.couponList=t;for(var e=[],r=0;r<n.couponList.length;r++)!1!==n.couponList[r].usable&&e.push(n.couponList[r]);if(e.length>0)if(i&&"null"!==i)for(var o=0;o<e.length;o++){if(e[o].coupon.id==i)return n.couponId=e[o].coupon.id,n.couponMoney=e[o].couponGroup.money,n.couponSign=e[o].coupon.sign,n.couponName=e[o].couponGroup.name,!1;n.couponName=e.length+"张可用"}else n.couponName=e.length+"张可用"}}).catch(function(){o("网络错误，请稍后重试！")}),c){n.addressId=c;var y="/api/trade/address/"+n.addressId;tn(y,{},"GET",!1).then(function(r){r.success&&r.data?(n.orderAddress=r.data,t(".order-no-address").hide(),t(".order-have-address").show(),e(n.addressId)):(t(".order-no-address").show(),t(".order-have-address").hide())}).catch(function(){t(".order-no-address").show(),t(".order-have-address").hide()})}else tn("/api/trade/list-address",{},"GET",!1).then(function(r){r.success&&r.data.length?(n.orderAddress=r.data[0],n.addressId=n.orderAddress.id,n.isAddress=!1,t(".order-no-address").hide(),t(".order-have-address").show(),e(n.addressId)):(t(".order-no-address").show(),t(".order-have-address").hide())}).catch(function(){o("网络错误，请稍后重试！")});tn("/api/userscore/get-user-score",{},"GET").then(function(t){t.scoreEarned&&(n.currIntegral=t.scoreEarned,n.isIntegral=!0)}).catch(function(){o("网络错误，请稍后重试！")})},methods:{selectVal:function(e){this.type=e.target.value,"2"===this.type?t(".js-company").fadeIn():t(".js-company").fadeOut()},goCouponSelect:function(){location.href="/gp/coupon?p="+this.productSpecification+"&&addressId="+this.addressId+"&&buyRoute="+this.buyRoute+"&&couponId="+this.couponId},getVersion:function(){++this.count>=5&&(o("2017/09/18-10-01-01"),this.count=0)},addAddress:function(){location.href="/gp/address?orderPage=true&&p="+this.productSpecification+"&&buyRoute="+this.buyRoute+"&&"+this.couponInfo},orderAddressEdit:function(){location.href="/gp/addresslist?p="+this.productSpecification+"&&buyRoute="+this.buyRoute+"&&"+this.couponInfo},submitOrder:function(){function t(){i(!0);var t={};t={addressId:e.addressId,note:e.msg,productSpecificationIds:e.productId,receiptTitle:e.companyName,receiptFlag:e.type,couponId:e.couponId,sign:e.couponSign,taxpayerIdentificationNumber:e.taxpayerNum,buyRoute:e.buyRoute},tn("/api/trade/create-porder",t,"POST").then(function(t){t.success?(i(!1),mixpanel.track("MobileMall: Confirm Order: SubmitBtn: Click",{state:'@"success"}'}),xksTrack.track("MobileMall:Confirm_Order:SubmitBtn:Submit",{state:"success"}),t.data.alipayUrl?(o("订单提交成功！"),n(t.data.pOrder.id,t.data.alipayUrl)):12===t.data.pOrder.state?(o("订单提交成功！"),location.href="/gp/heartcodeok?state=12"):1===t.data.pOrder.state&&(o("订单提交成功！"),location.href="/gp/heartcodeok?state=1")):(i(!1),o(t.retMsg),mixpanel.track("MobileMall: Confirm Order: SubmitBtn: Click",{state:'@"fail"}'}),xksTrack.track("MobileMall:Confirm_Order:SubmitBtn:Submit",{state:"fail"}))}).catch(function(){i(!1),o("网络错误，请稍后重试！")})}if(""===this.addressId)return void o("请完善收货地址");if("2"===this.type){if(""===this.companyName)return void o("请输入公司抬头");if(""===this.taxpayerNum)return void o("请输入纳税人识别号")}var e=this;!0===e.isSubmit&&(this.totalMoney>0?"0"!==this.type&&"2"===this.writeReceipt?r({msg:"所选商品中只有部分商品<br>可以开发票"},t):t():!0===this.isIntegral&&parseInt(this.userNeedScore)>parseInt(this.currIntegral)?r({msg:"心币不足",onebutton:!0}):0===parseInt(this.userNeedScore)?t():r({msg:"是否确认扣除"+this.userNeedScore+"心币"},t))},showChoose:function(){t("#order-list").fadeIn(),t("#app").addClass("noscroll")},hideChooser:function(){t("#order-list").fadeOut(),t("#app").removeClass("noscroll")}}})});
